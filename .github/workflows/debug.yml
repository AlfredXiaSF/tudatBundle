name: tudatBundleCI
# adapted from:
# https://github.com/jherico/starter-workflows/blob/master/ci/cmake.yml
# and
# https://github.com/onqtam/doctest/blob/master/.github/workflows/main.yml

on: 
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

env:
  BUILD_TYPE: Release

jobs:
  build:
    name: ${{ matrix.name }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        name: [
          windows-gcc,
          windows-clang,
        ]

        include:

        - name: windows-gcc
          os: windows-latest
          compiler: gcc

        - name: windows-clang
          os: windows-latest
          compiler: clang

    steps:
    - uses: actions/checkout@v1

    - name: Install clang on Windows
      if: ( contains(matrix.os, 'windows') &&
            contains(matrix.compiler, 'clang') )
      shell: powershell
      run: |
        Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')
        scoop install llvm --global
        echo "::set-env name=PATH::$env:PATH"

    - name: Set Compiler Environment
      shell: bash
      run: |
        if [ "${{ matrix.compiler }}" = "clang" ]; then
          echo "::set-env name=CC::clang"
          echo "::set-env name=CXX::clang++"
        else
          echo "::set-env name=CC::gcc"
          echo "::set-env name=CXX::g++"
        fi

    - name: Debug info
      shell: bash
      run: whereis unistd.h
